<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="generator" content="Hugo 0.16" />
    <meta name="description" content="">


    <link rel="shortcut icon" href="http://mongodb.github.io/mongo-cxx-odm/images/favicon.png" type="image/x-icon" />

    
    <title>Operators</title>
    <link href="http://mongodb.github.io/mongo-cxx-odm/css/nucleus.css" rel="stylesheet">
    <link href="http://mongodb.github.io/mongo-cxx-odm/css/font-awesome.min.css" rel="stylesheet">
    <link href="http://mongodb.github.io/mongo-cxx-odm/css/hybrid.css" rel="stylesheet">
    <link href="http://mongodb.github.io/mongo-cxx-odm/css/featherlight.min.css" rel="stylesheet">
    <link href="http://mongodb.github.io/mongo-cxx-odm/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="http://mongodb.github.io/mongo-cxx-odm/css/theme.css" rel="stylesheet">
    <link href="http://mongodb.github.io/mongo-cxx-odm/css/hugo-theme.css" rel="stylesheet">
    <style type="text/css">:root #header + #content > #left > #rlblock_left
    {display:none !important;}</style>
    <link href="http://mongodb.github.io/mongo-cxx-odm/css/docs.css" rel="stylesheet">

  </head>
  <body class="" data-url="/4-updates/operators/">
    <nav id="sidebar">
  <div id="header-wrapper">
    <div id="header">
      <html>
<body>
	<img src="http://mongodb.github.io/mongo-cxx-odm/images/logo.png"/>
</body>
</html>

      
    </div>
</div>


  <div class="highlightable">
    <ul class="topics">
      
      
      
      

      <li class="dd-item  " data-nav-id="/1-basics/">
        <a href="http://mongodb.github.io/mongo-cxx-odm/1-basics/">
          <span>
            
              <b>1. </b>
            
             Basics
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/1-basics/what-is-mangrove/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/1-basics/what-is-mangrove/">
                <span>What is Mangrove?     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/1-basics/installation/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/1-basics/installation/">
                <span>Installation     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/1-basics/quick-tour/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/1-basics/quick-tour/">
                <span>Quick Tour     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      
      

      <li class="dd-item  " data-nav-id="/2-models/">
        <a href="http://mongodb.github.io/mongo-cxx-odm/2-models/">
          <span>
            
              <b>2. </b>
            
             Models
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/2-models/introduction/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/2-models/introduction/">
                <span>Introduction     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/2-models/allowed-types/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/2-models/allowed-types/">
                <span>Allowed Types     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/2-models/custom_id/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/2-models/custom_id/">
                <span>Custom _id Type     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/2-models/dynamic-schemas/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/2-models/dynamic-schemas/">
                <span>Dynamic Schemas     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      
      

      <li class="dd-item  " data-nav-id="/3-queries/">
        <a href="http://mongodb.github.io/mongo-cxx-odm/3-queries/">
          <span>
            
              <b>3. </b>
            
             Queries
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/3-queries/introduction/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/3-queries/introduction/">
                <span>Introduction     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item " data-nav-id="/3-queries/operators/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/3-queries/operators/">
                <span>Operators     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      
      

      <li class="dd-item  parent" data-nav-id="/4-updates/">
        <a href="http://mongodb.github.io/mongo-cxx-odm/4-updates/">
          <span>
            
              <b>4. </b>
            
             Updates
            
           </span>
        </a>
        
        <ul>
          
          
          
          
            <li class="dd-item " data-nav-id="/4-updates/introduction/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/4-updates/introduction/">
                <span>Introduction     </i></span>
              </a>
            </li>
          
          
          
            <li class="dd-item active" data-nav-id="/4-updates/operators/">
              <a href="http://mongodb.github.io/mongo-cxx-odm/4-updates/operators/">
                <span>Operators     </i></span>
              </a>
            </li>
          
          
        </ul>
        
      </li>
      
      
      
      

      <li class="dd-item  " data-nav-id="/5-the-bson-mapper/">
        <a href="http://mongodb.github.io/mongo-cxx-odm/5-the-bson-mapper/">
          <span>
            
              <b>5. </b>
            
             The BSON Mapper
            
           </span>
        </a>
        
      </li>
      
      
      
      <li class="dd-item">
        <a href="http://mongodb.github.io/mongo-cxx-odm/api/html">
          <span> 
            <b> 6. </b> API Docs
          </span>
        </a>
      </li>
      <li class="dd-item">
        <a href="https://github.com/mongodb/mongo-cxx-odm">
          <span> 
            <b> 7. </b> Source Code
          </span>
        </a>
      </li>
    </ul>
    <hr>
      
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fa fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>
    </section>
  </div>
</nav>

        <section id="body">
        <div id="overlay"></div>

        <div class="padding highlightable">

            <div id="top-bar">
              
              <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                  <span id="sidebar-toggle-span">
                      <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                        <i class="fa fa-bars"></i>
                      </a>
                  </span>
                
                <span id="toc-menu"><a href=""><i class="fa fa-list-alt"></i></a></span>
                
                
                
                
                  
                
                  
                
                  
                
                  
                    
                    
                <a href="http://mongodb.github.io/mongo-cxx-odm/4-updates/" itemprop="url"><span itemprop="title">Updates</span></a> <i class="fa fa-angle-right"></i>
                    
                  
                
                  
                
                <span itemprop="title"> Operators</span>
              </div>
              
                  <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li>
<ul>
<li><a href="#field-update-operators">Field Update Operators</a></li>
<li><a href="#array-update-operators">Array Update Operators</a></li>
<li><a href="#bitwise-operators">Bitwise Operators</a></li>
<li><a href="#isolation-operators">Isolation Operators</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

              

            </div>
            
    	        <div id="body-inner">
                
                <h1>Operators</h1>
                



<p>The following is a list of the available <strong>update operators</strong> for the Mangrove expression builder.
This page follows the structure of the

<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/">MongoDB update operator documentation <i class="fa fa-external-link"></i></a>
.</p>

<h3 id="field-update-operators">Field Update Operators</h3>

<ul>
<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/inc/">$inc <i class="fa fa-external-link"></i></a>
</code></p>

<p>The <code>$inc</code> operator is provided as the C++ <code>+=</code> and <code>-=</code> operators.
The unary <code>++</code> and <code>--</code> can also be used.
It is only enabled for fields with a numeric type.</p>

<pre><code class="language-cpp">// Increment the age of users in the database.
// The following three statements are the same, and produce the BSON:
// { $inc: {age: 1}}
auto res = User::update_many({}, MANGROVE_KEY(User::age) += 1);
res = User::update_many({}, MANGROVE_KEY(User::age)++);
res = User::update_many({}, ++MANGROVE_KEY(User::age));

// Decrement the time left in the free trial of some product.
// The following three statements are the same, and produce the BSON:
// { $inc: {trial_days_left: -1}}
auto res = User::update_many({}, MANGROVE_KEY(User::trial_days_left) -= 1);
res = User::update_many({}, MANGROVE_KEY(User::trial_days_left)--);
res = User::update_many({}, --MANGROVE_KEY(User::trial_days_left));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/mul/">$mul <i class="fa fa-external-link"></i></a>
</code></p>

<p>The <code>$mul</code> operator is provided as the C++ <code>*=</code> operator.
It is only enabled for fields with a numeric type.</p>

<pre><code class="language-cpp">// Double the scores of users in a game.
// { $mul: {score: 2}}
auto res = User::update_many({}, MANGROVE_KEY(User::score) *= 2);
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/rename/">$rename <i class="fa fa-external-link"></i></a>
</code></p>

<p><em>Mangrove does not provide the <code>$rename</code> operator, since changing the name of fields created during serialization is not possible.</em></p></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/setOnInsert/">$setOnInsert <i class="fa fa-external-link"></i></a>
</code></p>

<p>This operator is provided as a member function on the fields.
The given value must be the same type as the field (or implicitly cast to it).</p>

<pre><code class="language-cpp">// Reset the score of a user, or create a new one.
// Note the use of the &quot;upsert&quot; option, to enable insertion of a new document if necessary.
// { $set: {score: 0}, $setOnInsert: {hours_played: 0} }
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                 (MANGROVE_KEY(User::score) = 0,
                                  MANGROVE_KEY(User::hours_played).set_on_insert(0)),
                                 mongocxx::options::update{}.upsert(true));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/set/">$set <i class="fa fa-external-link"></i></a>
</code></p>

<p>The <code>$set</code> operator is provided as the C++ assignment operator <code>=</code>.
The given value must be the same type as the field (or implicitly cast to it).</p>

<pre><code class="language-cpp">// Edit the username of a user
// { $set: {username: &quot;brohemian_raphsody&quot;}}
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                MANGROVE_KEY(User::username) = &quot;brohemian_raphsody&quot;);
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/unset/">$unset <i class="fa fa-external-link"></i></a>
</code></p>

<p>This operator is provided as a member function on fields that takes no arguments.
The field it is used on must be an <code>optional</code> field.
Otherwise, an error is raised at compile time.</p>

<pre><code class="language-cpp">// Remove the &quot;current_school&quot; field from a user who has graduated:
// {$unset: {current_school: &quot;&quot;}}
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                 MANGROVE_KEY(User::current_school).unset());
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/min/">$min <i class="fa fa-external-link"></i></a>
</code></p>

<p>This operator is provided as a member function on fields.
The given value must be the same type as the field (or implicitly cast to it).</p>

<pre><code class="language-cpp">// Update a user's lowest score in a game.
// {$min: {lowest_score: 45}}
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                 MANGROVE_KEY(User::lowest_score).min(45));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/max/">$max <i class="fa fa-external-link"></i></a>
</code></p>

<p>This operator is provided as a member function on fields.
The given value must be the same type as the field (or implicitly cast to it).</p>

<pre><code class="language-cpp">// Update a user's high score in a game.
// {$max: {lowest_score: 1000}}
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                 MANGROVE_KEY(User::high_score).max(1000));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/currentDate/">$currentDate <i class="fa fa-external-link"></i></a>
</code></p>

<p>To set a field to the current date using the <code>$currentDate</code> operator, one can use assign the reserved value <code>mangrove::current_date</code> to a field using <code>=</code>. This is only enabled for date or timestamp fields.
The <code>$type</code> argument to the <code>$currentDate</code> operator is determined by the type of the field itself.</p>

<pre><code class="language-cpp">// Update a user's &quot;last played&quot; date.
// { $currentDate: {last_played: {$type: &quot;date&quot;}} }
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                 MANGROVE_KEY(User::last_played) = mangrove::current_date);
</code></pre></li>
</ul>

<h3 id="array-update-operators">Array Update Operators</h3>

<ul>
<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/positional/">$ <i class="fa fa-external-link"></i></a>
</code></p>

<p>The <code>$</code> operator is used to update the first element in an array that matches the given query.
This is done in Mangrove by using the <code>.first_match()</code> member function on name-value-pairs.
The result is then used in an update expression as if it were a regular name-value pair.</p>

<p>This operator is only enabled for fields that are arrays.</p>

<pre><code class="language-cpp">// Double a players' first score over 1000.
// { $mul: {&quot;scores.$&quot;: 2}}
auto res = User::update_many(MANGROVE_KEY(User::scores).elem_match(MANGROVE_ELEM(User::scores) &gt; 1000),
                                  MANGROVE_KEY(User::scores).first_match() *= 2);
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/addToSet/">$addToSet <i class="fa fa-external-link"></i></a>
</code></p>

<p>This operator is available as a member function on the fields objects.
It is only enabled for fields that are arrays.
There are two versions: one that takes a single value to be added to the array,
and another that takes an iterable containing multiple values to be added.
The second one is equivalent to using the <code>$each</code> modifier with <code>$addToSet</code>.</p>

<pre><code class="language-cpp">// Add a movie to a user's set of purchased movies.
// { $addToSet: {purchased_movies: &quot;The Matrix&quot;} }
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                  MANGROVE_KEY(User::purchased_movies).add_to_set(&quot;The Matrix&quot;));
// Add several movies at once:
// { $addToSet: {purchased_movies:
//                  {$each: [&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;]}
//              } }
auto movies = std::vector&lt;std::string&gt;{&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;};
res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                             MANGROVE_KEY(User::purchased_movies).add_to_set(movies));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/pop/">$pop <i class="fa fa-external-link"></i></a>
</code></p>

<p>This operator is provided as a member function on the name-value-pairs.
It accepts a single parameter, a boolean <code>last</code> that determines whether an element should be removed
from the end (if <code>last == true</code>) of the list, or the start (if <code>last == false</code>).</p>

<pre><code class="language-cpp">// Remove the earliest score of some user.
// { $pop: {scores: -1} }
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                            MANGROVE_KEY(User::scores).pop(false));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/pull/">$pull <i class="fa fa-external-link"></i></a>
</code></p>

<p>This operator is provided as a member function on the name-value-pairs.
There are two options: one which takes a value to be removed from the list,
and another which takes a query and removes values that match the given query.</p>

<p>In the second one, the syntax for queries is similar to that of the <code>$elemMatch</code> operators.
One can use find queries as they would at the top level (i.e. when passing to <code>find(...)</code>),
except that scalar arrays need to use the <code>MANGROVE_ELEM</code> macro to refer to elements.</p>

<p><code>$pull</code> is only enabled for fields that are arrays.</p>

<pre><code class="language-cpp">// Remove the first matrix movie from a user's purchased movies.
// { $pull: {purchased_movies: &quot;The Matrix&quot;} }
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                  MANGROVE_KEY(User::purchased_movies).pull(&quot;The Matrix&quot;));

// Remove any and all matrix movies from a user's purchased movies.
// { $pull: {purchased_movies: {$regex: &quot;matrix&quot;, $options: &quot;i&quot;}} }
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                 MANGROVE_KEY(User::purchased_movies).pull(MANGROVE_ELEM(User::purchased_movies)).regex(&quot;matrix&quot;, &quot;i&quot;));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/pullAll/">$pullAll <i class="fa fa-external-link"></i></a>
</code></p>

<p>This operator is provided as a member function on the fields.
It accepts an iterable argument, that contains a list of values to remove from the field&rsquo;s array.
This operator is only enabled for fields that are arrays.</p>

<pre><code class="language-cpp">// Remove the three matrix movies from a user's purchased movies.
// { $pullAll: {purchased_movies: [&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;]} }
auto movies = std::vector&lt;std::string&gt;{&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;};
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                 MANGROVE_KEY(User::purchased_movies).pullAll(movies));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/pushAll/">$pushAll <i class="fa fa-external-link"></i></a>
</code></p>

<p><em><code>$pushAll</code> is deprecated, one should use <code>$push</code> instead.</em></p></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/push/">$push <i class="fa fa-external-link"></i></a>
</code></p>

<p>The <code>$push</code> operator is provided as a member function on the fields.
There are two versions: one which takes a single value to push onto the array,
and another which takes an iterable, and pushes all the values onto the array
using the <code>$each</code> modifier.</p>

<p>This operator is only enabled for fields that are arrays.</p>

<pre><code class="language-cpp">// Push a single movie to a user's watched_movies field:
// {$push: {watched_movies: &quot;The Matrix&quot;}}
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                 MANGROVE_KEY(User::watched_movies).push(&quot;The Matrix&quot;));

// This user watched every Matrix movie in one sitting:
// {$push: {watched_movies: {$each: [&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;]}}}
auto movies = std::vector&lt;std::string&gt;{&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;};
res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                            MANGROVE_KEY(User::watched_movies).push(movies));
</code></pre>

<p>As per the MongoDB documentation, <code>$push</code> can accept several optional modifiers.
Modifiers to this operator can either be specified
as <code>optional</code> arguments to the function, or using a &ldquo;fluent&rdquo; API.
This means that parameters are given as <code>.push(values).slice(...).sort(...).position(...)</code>.</p>

<ul>
<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/slice/">$slice <i class="fa fa-external-link"></i></a>
</code>
&mdash; this modifier takes a 32-bit integer that limits the number of array elements.</p>

<pre><code class="language-cpp">// Add movies to this user's history, but limit its length to 10.
// {
//  $push: {
//      watched_movies: {$each: [&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;],
//                       $slice: 10}
//      }
// }
auto movies = std::vector&lt;std::string&gt;{&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;};
res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                            MANGROVE_KEY(User::watched_movies).push(movies).slice(10));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/sort/">$sort <i class="fa fa-external-link"></i></a>
</code>
&mdash; this modifier takes either an integer that is &plusmn;1, or a <em>sort expression</em>.
An integer argument will sort values by their natural ordering, either in ascending (<code>+1</code>)
or descending (<code>-1</code>) order.
A <em>sort expression</em> represents an ordering based on a specific field.
It can be specified by calling the <code>.sort(bool ascending)</code> function on a name-value pair.
The boolean argument <code>ascending</code> orders elements in ascending order if <code>true</code>,
or descending if <code>false</code>.</p>

<pre><code class="language-cpp">// Add movies to this user's history, then sort movies in ascending order by their title.
// {
//  $push: {
//      watched_movies: {$each: [&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;],
//                       $sort: 1}
//      }
// }
auto movies = std::vector&lt;std::string&gt;{&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;};
res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                            MANGROVE_KEY(User::watched_movies).push(movies).sort(1));
</code></pre>

<p>If, in the above example, movies were not strings but documents, with a <code>title</code> and <code>rating</code>
field, one would be able to choose how to sort them as follows:</p>

<pre><code class="language-cpp">// Add movies to this user's history, then sort movies by rating in descending order.
// {
//  $push: {
//      watched_movies: {$each: [ {title: &quot;The Matrix&quot;, rating: 9},
//                                {title: &quot;The Matrix: Reloaded&quot;, rating: 7},
//                                {title: &quot;The Matrix: Revolutions&quot;, rating: 3} ],
//                       $sort: {rating: -1}}
//      }
// }

// brace-initialize &quot;Movie&quot; objects.
auto movies = std::vector&lt;Movie&gt;{{&quot;The Matrix&quot;, 9}, {&quot;The Matrix: Reloaded&quot;, 7},
                                       {&quot;The Matrix: Revolutions&quot;, 3}};
res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                            MANGROVE_KEY(User::watched_movies).push(movies).sort(MANGROVE_KEY(Movie::rating).sort(false)));
</code></pre></li>

<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/position/">$position <i class="fa fa-external-link"></i></a>
</code>
&mdash; this modifier takes an unsigned integer that represents a position in the array.</p>

<pre><code class="language-cpp">// Add movies to this user's history, but add them at the start (i.e. 0th position)
// of the array.
// {
//  $push: {
//      watched_movies: {$each: [&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;],
//                       $position: 0}
//      }
// }
auto movies = std::vector&lt;std::string&gt;{&quot;The Matrix&quot;, &quot;The Matrix: Reloaded&quot;, &quot;The Matrix: Revolutions&quot;};
res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                            MANGROVE_KEY(User::watched_movies).push(movies).position(0));
</code></pre></li>
</ul></li>
</ul>

<h3 id="bitwise-operators">Bitwise Operators</h3>

<ul>
<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/bit/">$bit <i class="fa fa-external-link"></i></a>
</code></p>

<p>Bitwise updates on fields can be performed using C++&rsquo;s built-in <code>&amp;=</code>, <code>|=</code>, and <code>^=</code> operators.
These are only enabled for integer fields.</p>

<pre><code class="language-cpp">// Perform bitwise operations on a user's age, because, hey, why not?!
// { $bit: {age: {and: 7}} }
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                 MANGROVE_KEY(User::age) &amp;= 7);

// { $bit: {age: {or: 7}} }
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                  MANGROVE_KEY(User::age) |= 7);

// { $bit: {age: {xor: 7}} }
auto res = User::update_one(MANGROVE_KEY(User::username) == &quot;raphofkhan&quot;,
                                   MANGROVE_KEY(User::age) ^= 7);
</code></pre></li>
</ul>

<h3 id="isolation-operators">Isolation Operators</h3>

<ul>
<li><p><code>
<a target="_blank" href="https://docs.mongodb.com/manual/reference/operator/update/isolated/">$isolated <i class="fa fa-external-link"></i></a>
</code></p>

<p>An update expression can be marked as isolated using the <code>$isolated</code> operator.
In Mangrove, is this done by passing the query expression used to match documents to the <code>mangrove::isolated</code> function.</p>

<pre><code class="language-cpp">// Set the 'can_buy_alcohol' flag for all users over the age of 21, but isolate the updates
// to avoid concurrency issues. This is equivalent to the mongo shell command:
// db.testcollection.updateMany({age: {$gt: 21}, $isolated: 1},
//                          {$set: {can_buy_alcohol: true}})
auto res = User::update_many(mangrove::isolated(MANGROVE_KEY(User::age) &gt;= 21),
                                 MANGROVE_KEY(User::can_buy_alcohol) = true);
</code></pre></li>
</ul>


      
      </div>
    </div>

    <div id="navigation">
        <a class="nav nav-prev" href="http://mongodb.github.io/mongo-cxx-odm/4-updates/introduction"> <i class="fa fa-chevron-left"></i></a>
        <a class="nav nav-next" href="http://mongodb.github.io/mongo-cxx-odm/5-the-bson-mapper/" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
    </div>

    </section>
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/jquery-2.x.min.js"></script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/clipboard.min.js"></script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/perfect-scrollbar.min.js"></script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/jquery.sticky-kit.min.js"></script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/featherlight.min.js"></script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/html5shiv-printshiv.min.js"></script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/modernizr.custom.71422.js"></script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/learn.js"></script>
    <script src="http://mongodb.github.io/mongo-cxx-odm/js/hugo-learn.js"></script>
    

  </body>
</html>

